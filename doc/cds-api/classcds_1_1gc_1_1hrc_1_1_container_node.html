<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>cds: cds::gc::hrc::ContainerNode Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">cds
   &#160;<span id="projectnumber">1.4.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Data&#160;Fields</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespacecds.html">cds</a></li><li class="navelem"><a class="el" href="namespacecds_1_1gc.html">gc</a></li><li class="navelem"><a class="el" href="namespacecds_1_1gc_1_1hrc.html">hrc</a></li><li class="navelem"><a class="el" href="classcds_1_1gc_1_1hrc_1_1_container_node.html">ContainerNode</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pro-methods">Protected Member Functions</a> &#124;
<a href="#pro-attribs">Protected Attributes</a> &#124;
<a href="#friends">Friends</a>  </div>
  <div class="headertitle">
<div class="title">cds::gc::hrc::ContainerNode Class Reference<span class="mlabels"><span class="mlabel">abstract</span></span></div>  </div>
</div><!--header-->
<div class="contents">

<p>Base class for all HRC-based container's node.  
 <a href="classcds_1_1gc_1_1hrc_1_1_container_node.html#details">More...</a></p>

<p><code>#include &lt;cds/gc/hrc/hrc.h&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:adec6dc6af0514b514290d2e0bbf82440"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="adec6dc6af0514b514290d2e0bbf82440"></a>
<a class="el" href="classcds_1_1ref__counter.html#a02040f002702143eb4a1be493738f8d3">unsigned_ref_counter::ref_counter_type</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcds_1_1gc_1_1hrc_1_1_container_node.html#adec6dc6af0514b514290d2e0bbf82440">getRefCount</a> () const </td></tr>
<tr class="memdesc:adec6dc6af0514b514290d2e0bbf82440"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns count of reference for the node. <br/></td></tr>
<tr class="separator:adec6dc6af0514b514290d2e0bbf82440"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acfbffeb69902756b26a701c0b31cb270"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="acfbffeb69902756b26a701c0b31cb270"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcds_1_1gc_1_1hrc_1_1_container_node.html#acfbffeb69902756b26a701c0b31cb270">incRefCount</a> ()</td></tr>
<tr class="memdesc:acfbffeb69902756b26a701c0b31cb270"><td class="mdescLeft">&#160;</td><td class="mdescRight">Increments the reference counter of the node. <br/></td></tr>
<tr class="separator:acfbffeb69902756b26a701c0b31cb270"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:affe30691ea4d724522ef1d5f97e18073"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="affe30691ea4d724522ef1d5f97e18073"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcds_1_1gc_1_1hrc_1_1_container_node.html#affe30691ea4d724522ef1d5f97e18073">decRefCount</a> ()</td></tr>
<tr class="memdesc:affe30691ea4d724522ef1d5f97e18073"><td class="mdescLeft">&#160;</td><td class="mdescRight">Decrements the reference counter of the node. Returns <code>true</code> if ref counter is 0. <br/></td></tr>
<tr class="separator:affe30691ea4d724522ef1d5f97e18073"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad1f02401597a5853a4ef068382919651"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ad1f02401597a5853a4ef068382919651"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcds_1_1gc_1_1hrc_1_1_container_node.html#ad1f02401597a5853a4ef068382919651">isDeleted</a> () const </td></tr>
<tr class="memdesc:ad1f02401597a5853a4ef068382919651"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the mark that the node is deleted or not. <br/></td></tr>
<tr class="separator:ad1f02401597a5853a4ef068382919651"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr class="memitem:a609759a95717e9a41e9dd2ae4b455e06"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcds_1_1gc_1_1hrc_1_1_container_node.html#a609759a95717e9a41e9dd2ae4b455e06">cleanUp</a> (<a class="el" href="classcds_1_1gc_1_1hrc_1_1_thread_g_c.html">ThreadGC</a> *pGC)=0</td></tr>
<tr class="separator:a609759a95717e9a41e9dd2ae4b455e06"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a249bcf5fd2c73f30648f9a07547cf181"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcds_1_1gc_1_1hrc_1_1_container_node.html#a249bcf5fd2c73f30648f9a07547cf181">terminate</a> (<a class="el" href="classcds_1_1gc_1_1hrc_1_1_thread_g_c.html">ThreadGC</a> *pGC, bool bConcurrent)=0</td></tr>
<tr class="separator:a249bcf5fd2c73f30648f9a07547cf181"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pro-attribs"></a>
Protected Attributes</h2></td></tr>
<tr class="memitem:aa68da8ab5747b8d3c39f338c2a2b093f"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aa68da8ab5747b8d3c39f338c2a2b093f"></a>
<a class="el" href="namespacecds.html#ada8bf2b6bb8354f4e9977cfdff9fe241">unsigned_ref_counter</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcds_1_1gc_1_1hrc_1_1_container_node.html#aa68da8ab5747b8d3c39f338c2a2b093f">m_RC</a></td></tr>
<tr class="memdesc:aa68da8ab5747b8d3c39f338c2a2b093f"><td class="mdescLeft">&#160;</td><td class="mdescRight">reference counter <br/></td></tr>
<tr class="separator:aa68da8ab5747b8d3c39f338c2a2b093f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a28e9da33771c7b29ca020464215cce51"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a28e9da33771c7b29ca020464215cce51"></a>
std::atomic&lt; bool &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcds_1_1gc_1_1hrc_1_1_container_node.html#a28e9da33771c7b29ca020464215cce51">m_bTrace</a></td></tr>
<tr class="memdesc:a28e9da33771c7b29ca020464215cce51"><td class="mdescLeft">&#160;</td><td class="mdescRight"><em>true</em> - node is tracing by Scan <br/></td></tr>
<tr class="separator:a28e9da33771c7b29ca020464215cce51"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac3994dc30dd12a6f97e778e9cd00cc34"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ac3994dc30dd12a6f97e778e9cd00cc34"></a>
std::atomic&lt; bool &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcds_1_1gc_1_1hrc_1_1_container_node.html#ac3994dc30dd12a6f97e778e9cd00cc34">m_bDeleted</a></td></tr>
<tr class="memdesc:ac3994dc30dd12a6f97e778e9cd00cc34"><td class="mdescLeft">&#160;</td><td class="mdescRight">@ true - node is deleted <br/></td></tr>
<tr class="separator:ac3994dc30dd12a6f97e778e9cd00cc34"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="friends"></a>
Friends</h2></td></tr>
<tr class="memitem:aed63c75a6d93c19ed9b14ec512386a34"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aed63c75a6d93c19ed9b14ec512386a34"></a>
class&#160;</td><td class="memItemRight" valign="bottom"><b>GarbageCollector</b></td></tr>
<tr class="separator:aed63c75a6d93c19ed9b14ec512386a34"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3d476ed6cac2fbf542b878b1664eb3c3"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a3d476ed6cac2fbf542b878b1664eb3c3"></a>
class&#160;</td><td class="memItemRight" valign="bottom"><b>ThreadGC</b></td></tr>
<tr class="separator:a3d476ed6cac2fbf542b878b1664eb3c3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab018f70a74cd3c15f863a8c59c86d89a"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ab018f70a74cd3c15f863a8c59c86d89a"></a>
class&#160;</td><td class="memItemRight" valign="bottom"><b>gc::HRC</b></td></tr>
<tr class="separator:ab018f70a74cd3c15f863a8c59c86d89a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Base class for all HRC-based container's node. </p>
<p>This interface is placed to the separate class since in the presence of a garbage collector the lifetime of the node is greater than lifetime of its container. Reclaimed node may be physically deleted later than its container. So, the <a class="el" href="classcds_1_1gc_1_1hrc_1_1_container_node.html" title="Base class for all HRC-based container&#39;s node.">ContainerNode</a> must be smarter than the usual. </p>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="a609759a95717e9a41e9dd2ae4b455e06"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual void cds::gc::hrc::ContainerNode::cleanUp </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classcds_1_1gc_1_1hrc_1_1_thread_g_c.html">ThreadGC</a> *&#160;</td>
          <td class="paramname"><em>pGC</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span><span class="mlabel">pure virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>[Gidenstam 2006]: "The procedure <code>CleanUpNode</code> will make sure that all claimed references from the links of the given node will only point to active nodes, thus removing redundant passages through an arbitrary number of deleted nodes"</p>
<p>The pseudocode of this method must be like following: </p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="classcds_1_1gc_1_1hrc_1_1_container_node.html#a609759a95717e9a41e9dd2ae4b455e06">cleanUp</a>( ThreadGC * pGC )</div>
<div class="line">    <span class="keywordflow">for</span> all x where link[x] of node is reference-counted <span class="keywordflow">do</span></div>
<div class="line">retry:</div>
<div class="line">        node1 := link[x]    ;</div>
<div class="line">        <span class="keywordflow">if</span> node1 != NULL and node1.m_bDeleted then</div>
<div class="line">            node2 := node1-&gt;link[x]    ;</div>
<div class="line">            pGC-&gt;CASRef( this-&gt;link[x], node1, node2 );</div>
<div class="line">            pGC-&gt;releaseRef( node2 );</div>
<div class="line">            pGC-&gt;releaseRef( node1 );</div>
<div class="line">            <span class="keywordflow">goto</span> retry;</div>
<div class="line">        pGC-&gt;releaseRef(node1);</div>
</div><!-- fragment --><p>Be aware to use hazard pointers inside implementation of this method. cleanUp is called from the container's method when deleting the nodes. However, some hazard pointers may be occupied by container's method. You should allocate new hazard pointers inside <code>cleanUp</code> method, for example: </p>
<div class="fragment"><div class="line">gc::hrc::AutoHPArray&lt;2&gt; hpArr( *pGC )    ;</div>
</div><!-- fragment --> 
</div>
</div>
<a class="anchor" id="a249bcf5fd2c73f30648f9a07547cf181"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual void cds::gc::hrc::ContainerNode::terminate </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classcds_1_1gc_1_1hrc_1_1_thread_g_c.html">ThreadGC</a> *&#160;</td>
          <td class="paramname"><em>pGC</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>bConcurrent</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span><span class="mlabel">pure virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>[Gidenstam 2006]: "The procedure <code>TerminateNode</code> will make sure that none of the links in the given node will have any claim on any other node. TerminateNode is called on a deleted node when there are no claims from any other node or thread to the node"</p>
<p>The pseudocode of this method must be like following: </p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="classcds_1_1gc_1_1hrc_1_1_container_node.html#a249bcf5fd2c73f30648f9a07547cf181">terminate</a>( ThreadGC * pGC, <span class="keywordtype">bool</span> bConcurrent)</div>
<div class="line">    <span class="keywordflow">if</span> !bConcurrent</div>
<div class="line">        <span class="keywordflow">for</span> all this-&gt;link where link is reference-counted <span class="keywordflow">do</span></div>
<div class="line">            link := NULL ;</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">        <span class="keywordflow">for</span> all this-&gt;link where link is reference-counted <span class="keywordflow">do</span></div>
<div class="line">            repeat node1 := link ;</div>
<div class="line">            until pGC-&gt;CASRef(link,node1,NULL);</div>
</div><!-- fragment --> 
</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>cds/gc/hrc/hrc.h</li>
</ul>
</div><!-- contents -->
		<hr/>
		<div align="right">
			<b>cds</b> <b>1.4.0</b> 
			Developed by <i>Maxim Khiszinsky aka khizmax</i> 2007 - 2012
			<br/>
			<i>Autogenerated Mon May 20 2013 00:37:58 by Doxygen 1.8.3.1</i>
		</div>
	</BODY>
</HTML>
